<app-sidebar></app-sidebar>

<div class="pt-5 mt-2 mb-4">
  <h1 class="mt-2 mt-md-4 mb-3 pt-5">Productos</h1>
  <div class="d-flex flex-wrap flex-md-nowrap justify-content-between">
    <p class="text-muted">
      Este módulo lista todos los productos de la tienda.
    </p>
    <p class="font-size-sm font-weight-medium pl-md-4">
      <a class="text-nowrap" routerLink="/dashboard/productos" rel="noopener">
        Regresar<i class="cxi-angle-right font-size-base align-middle ml-1"></i>
      </a>
    </p>
  </div>
</div>

<div class="card box-shadow-sm">
  <div class="card-header d-flex justify-content-between">
    <h5 style="margin-bottom: 0px">
      Inventario del Producto {{ product.title }}
    </h5>
    <button (click)="download_excel()" type="button" class="btn btn-success ml-4"><i class="cxi-files"></i> Exportar Excel</button>
  </div>
  <div class="card-header">
    <div class="row">
      <div class="col-12">
        <form #inventoryForm="ngForm" (ngSubmit)="registerInventory(inventoryForm)" class="form-inline">
          <label class="sr-only">Cantidad</label>
          <input name="quantity" [(ngModel)]="inventory.quantity" class="form-control mb-3 mr-sm-4" type="number" placeholder="Cantidad" autocomplete="off" required  />
          <label class="sr-only">Proveedor</label>
          <input name="supplier" [(ngModel)]="inventory.supplier" class="form-control mb-3 mr-sm-4" type="text" placeholder="Proveedor" autocomplete="off" required  />
          <button *ngIf="!load_btn" class="btn btn-primary mb-3" type="submit">Ingresar</button>
          <button *ngIf="load_btn" class="btn btn-primary mb-3" type="button" disabled>
            <i class="spinner-border spinner-border-sm me-2"></i>Cargando...
          </button>
        </form>
      </div>
    </div>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead>
          <tr class="thead-dark">
            <th>#</th>
            <th>Admin</th>
            <th>Cantidad</th>
            <th>Proveedor</th>
            <th>Opciones</th>
          </tr>
        </thead>

        <ng-container *ngIf="load_data">
          <tbody>
             <td class="text-center" colspan="5">
                <ngx-skeleton-loader count="4" appearance="line" [theme]="{height: '40px'}" ></ngx-skeleton-loader>
             </td>
          </tbody>
        </ng-container>

        <ng-container *ngIf="!load_data">
          <tbody *ngIf="this.inventories.length === 0">
            <td class="text-center text-warning" colspan="6">No hay resultados.</td>
         </tbody>
          <tbody>
            <tr *ngFor="let product of inventories | paginate: { itemsPerPage: 5, currentPage: p }; let i = index">
                <th>{{i+1}}</th>
                <td>
                  {{product.admin.first_name}} <br/> 
                  {{product.admin.last_name}}
                </td>
                <td>{{product.quantity}}</td>
                <td>{{product.supplier}}</td>
                <td>
                  <div class="btn-group dropdown">
                    <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Opciones
                    </button>
                    <div class="dropdown-menu">
                      <!--  <a [routerLink]="['/dashboard/productos', product._id]" class="dropdown-product">Editar</a> -->
                       <a [attr.data-target]="'#delete-'+product._id" data-toggle="modal"  class="dropdown-item">Eliminar</a>
                    </div>
                 </div>
                
                  <div class="modal fade" id="delete-{{product._id}}" tabindex="-1" style="display: none;" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h4 class="modal-title">Eliminar registro</h4>
                          <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                        </div>
                        <div class="modal-body">
                          <p>Desea eliminar este registro ?</p>
                        </div>
                        <div class="modal-footer">
                          <button class="btn btn-secondary btn-sm" type="button" data-dismiss="modal">Cancelar</button>
                          <button class="btn btn-primary btn-sm" type="button" (click)="eliminar(product._id)" >Sí, eliminar!</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
            </tr>
            </tbody>
        </ng-container>
      </table>
    </div>
  </div>
  <div class="card-footer">
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
  </div>
</div>
